---
title: "DSCI 522 Lecture 4"
subtitle: "Data Validation with Pandera"
author: "Sky Sheng"
execute:
  eval: false
format:
  revealjs:
    theme: default
    transition: slide
    slide-number: true
    chalkboard: true
    logo: images/mds-hex-sticker.png
---

## Recap: Docker image on Docker Hub, then what?? ü§∑‚Äç‚ôÄÔ∏è

* Check out this [docker image for AI bias work](https://hub.docker.com/r/skysheng7/ai_bias/tags)

![](images/docker_hub.png){fig-align="center" style="margin-bottom: 0px;"}

## Next steps after Docker image on DockerHub

::: {.smaller style="font-size: 1em;"}
1. To access the docker image manually: 
* `docker pull username/image:tag`
* Example: `docker pull ttimbers/breast-cancer-predictor:3f8675c`
* Run the docker image using the following command 
```bash
docker run \
--rm \
-it \
-p 8887:8888 \
ttimbers/breast-cancer-predictor:3f8675c
```
:::

## Next steps after Docker image on DockerHub

::: {.smaller style="font-size: 1em;"}

2. To access the docker image using Docker Compose: 
* Create a `docker-compose.yml` file
* `docker compose up`
* `docker compose rm`

3. Update your documentation (README, CONTRIBUTING, etc.) about how others should use your docker image.
::: 

## ü§© Let's organize our complete workflow!
::: {.smaller style="font-size: 0.8em;"}
::: {.columns}
::: {.column width="50%"}
**üîß Local Development**

1. `conda create` & `conda install`
2. Create `environment.yml`
3. Add version numbers
4. Generate `conda-lock` file
5. Write `Dockerfile`
6. Create `docker-compose.yml`
7. Push to GitHub
:::

::: {.column width="50%"}
**‚òÅÔ∏è CI/CD & Deployment**

8. Add GitHub Actions workflow yml file
9. Add Docker Hub Personal Access Token (PAT)
10. Configure GitHub Secrets
11. Workflow runs (auto/manual)
12. Check Docker Hub for new image
13. Locally, `docker pull` new image
14. Locally, command line `docker run`
:::
:::
:::

## üê≥ New GitHub Actions Workflow yml file

* Check out this new [GitHub Actions workflow yml file](https://github.com/ttimbers/breast-cancer-predictor/blob/main/.github/workflows/docker-publish.yml) Tiffany created
* Now you can replace steps 13 + 14 to: `git pull` locally to extract updated `docker-compose.yml` file
* run `docker compose up` locally to start the container
* run `docker compose rm` locally to stop the container

## Let's breakdown the GitHub Action workflow!

* Inspect a [workflow output](https://github.com/skysheng7/AI_bias_in_farming/actions/workflows/docker-publish.yml)

## üôã‚Äç‚ôÄÔ∏è What is `&& \` in Dockerfile? 

::: {.smaller style="font-size: 0.8em;"}

```bash
# build on top of template of minimal notebook
FROM quay.io/jupyter/minimal-notebook:afe30f0c9ad8

# copy all conda environment dependencies
COPY conda-linux-64.lock /tmp/conda-linux-64.lock

# copy my local python package files to pip install in docker
COPY pyproject.toml /tmp/pyproject.toml
COPY src /tmp/src
COPY README.md /tmp/README.md

# conda install all the other packages
RUN mamba update --quiet --file /tmp/conda-linux-64.lock \
    && mamba clean --all -y -f \
    && fix-permissions "${CONDA_DIR}" \
    && fix-permissions "/home/${NB_USER}"

# install openai using pip because the openai package insatlled from conda has bug
# also install my local AI_representation_bias_in_farming as a python package
# 2025-06-22: added gpt-image-1 to the list of models
RUN pip install openai==1.57.0 \
    && python -m pip install -e /tmp 
```
:::

## Today: Data Validation!

![](images/garbage_otter.png){fig-align="center" style="margin-bottom: 20px;"}

<p style="position: fixed; bottom: -10px; right: 0px; font-size: 18px; color: gray; z-index: 1000;">Image generated by OpenAI GPT-5</p> 

## Remember this roast my repo? üî• 

::: {style="font-size: 1.5em; text-align: left; margin: 0 auto; display: block;"}
<https://shorturl.at/QSv7M>
:::

:::: {.columns style="margin-top: -50px; padding-top: -10;"}

::: {.column width="50%"}
::: {style="display: flex; justify-content: bottom; align-items: flex-start; margin-top: 0; padding-top: 0;"}
![](images/git_oven.png){style="margin-bottom: 0px;"}
:::
:::

::: {.column width="50%"}
::: {style="display: flex; justify-content: bottom; align-items: flex-start; margin-top: 0; padding-top: 0;"}
![](images/qr.png){style="margin-bottom: 0px;"}
:::
:::

::::

# Data validation in action

Check out this [data cleaning script](https://www.skysheng.io/moo4feed/articles/data_cleaning.html) I created for the Moo4Feed R package

# ‚úÖ Data validation [checklist](https://ubc-dsci.github.io/reproducible-and-trustworthy-workflows-for-data-science/lectures/130-data-validation.html)

* Group Milestone 2: Make sure you check all the boxes!

## üíª Let's work with [Pandera](https://github.com/skysheng7/DSCI522_data_validation_demo.git)!

![](images/validate_otter.png){fig-align="center" style="margin-bottom: 20px;"}

<p style="position: fixed; bottom: -10px; right: 0px; font-size: 18px; color: gray; z-index: 1000;">Image generated by OpenAI GPT-5</p> 

## üí¨ Discuss with your group: How will you conduct data validation for your data to check all the boxes?

* ‚úÖ Data validation [checklist](https://ubc-dsci.github.io/reproducible-and-trustworthy-workflows-for-data-science/lectures/130-data-validation.html)