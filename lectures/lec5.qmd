---
title: "DSCI 522 Lecture 5"
subtitle: "Non-interactive scripts"
author: "Sky Sheng"
execute:
  eval: false
format:
  revealjs:
    theme: default
    transition: slide
    slide-number: true
    chalkboard: true
    logo: ../images/mds-hex-sticker.png
---

## iClicker: How are you getting along with Docker?

::: {.columns}
::: {.column width="50%"}
<div style="text-align: center; font-weight: bold; font-size: 24px; margin-bottom: 0px;">(A)</div>
<div style="text-align: center;">
<img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXE4ODVjNW04djRvOW54cHo5enRjbjk1ZDB1cjhzZTE4ejJiZTdmciZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/6onMzNPjtFeCI/giphy.gif" style="width: 60%; max-width: 400px;"/>
</div>
:::

::: {.column width="50%"}
<div style="text-align: center; font-weight: bold; font-size: 24px; margin-bottom: 0px;">(B)</div>
<div style="text-align: center;">
<img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExMTNlamUxbnBuMTN1M3BkMmo1ZWg4d3FnOWlhZjB3bHZqaGFlNmNnOSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/hEIuLmpW9DmGA/giphy.gif" style="width: 65%; max-width: 400px;"/>
</div>
:::
:::

::: {.columns}
::: {.column width="50%"}
<div style="text-align: center; font-weight: bold; font-size: 24px; margin-bottom: 0px;">(C)</div>
<div style="text-align: center;">
<img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExZjhyc29ya2FqZmVzY2Fzc2o5Y3htZTh4bjZxOHBjazJvMXl0NGo2MCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/2tRNWDWKYQ5Y1Liot4/giphy.gif" style="width: 60%; max-width: 400px;"/>
</div>
:::

::: {.column width="50%"}
<div style="text-align: center; font-weight: bold; font-size: 24px; margin-bottom: 0px;">(D)</div>
<div style="text-align: center;">
<img src=" https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3cmc3aXpnMmdoZnVxdWhrbTBqZTMyMmZpbDdwMzczd3Y1cTdhZHVneiZlcD12MV9naWZzX3JlbGF0ZWQmY3Q9Zw/dIBUemhk5jPd9rfbHf/giphy.gif" style="width: 60%; max-width: 400px;"/>
</div>
:::
:::


<p style="position: fixed; bottom: 0px; left: 0px; font-size: 20px; color: gray; z-index: 1000;">[Source](https://giphy.com)</p>

# üßê Some questions from last week... 

## Q: "I did everything as instructed, why do I still get bugs?" ü•≤ 

::: {.incremental}
* Bad news: üêõ  are inevitable
    * Debugging is one of the most important skills to have as a data scientist
* Good news: Enemies of  üêõ:
    * Documentation, attention to details, perseverance, clean code, testing...
:::

## Q: "conda is not locking my pip packages!" üò±


::: {.smaller style="font-size: 0.8em;"}
::: {.incremental}
* Solution: `pip install` packages inside of your Dockerfile
    * (optional but recommended) Still add version numbers for your pip packages in `environment.yml` file for documentation purposes

```bash
# build on top of template of minimal notebook
FROM quay.io/jupyter/minimal-notebook:afe30f0c9ad8

# copy all conda environment dependencies
COPY conda-linux-64.lock /tmp/conda-linux-64.lock

# conda install all the other packages
RUN mamba update --quiet --file /tmp/conda-linux-64.lock \
    && mamba clean --all -y -f \
    && fix-permissions "${CONDA_DIR}" \
    && fix-permissions "/home/${NB_USER}"

# install openai using pip
RUN pip install openai==1.57.0
```
:::
:::

## Q: "The data I'm currently using do not have any missing data, why do I still need to do data validation?"

::: {.incremental}
* What about your future data? 
* We set up the data validation pipeline so that we can easily validate new data, and get warnings if there are missing values in the future.
:::

## iClicker: Why do we use `docker-compose` file?

-(A) To create and customize our own docker

-(B) To easily launch and stop our docker container in one command

-(C) To document the packages we used so that we can easily share with others

-(D) To prepare for publishing our docker image on Docker Hub

-(E) To make our life harder ü§∑‚Äç‚ôÄÔ∏è

## <span style="font-size: 0.9em;">Recap: Why do we need all of these? ü§Ø</span>

![](../images/conda5.png){width="2600px" style="margin-bottom: 0px;"}

<p style="position: fixed; bottom: 0px; left: 0px; font-size: 18px; color: gray; z-index: 1000;">Image generated by OpenAI GPT-5 and Canva</p> 

## <span style="font-size: 0.7em;">"I want more functionality in the docker container!"</span>

![](../images/docker1.png){width="3600px" style="margin-bottom: 0px;"}

<p style="position: fixed; bottom: 0px; left: 0px; font-size: 18px; color: gray; z-index: 1000;">Image generated by OpenAI GPT-5 and Canva</p> 

## <span style="font-size: 0.7em;">"`docker run` command is too LONG!"</span>

![](../images/docker2.png){width="3600px" style="margin-bottom: 0px;"}

<p style="position: fixed; bottom: 0px; left: 0px; font-size: 18px; color: gray; z-index: 1000;">Image generated by OpenAI GPT-5 and Canva</p> 

## <span style="font-size: 0.7em;">"I am tired of typing the same sequence of commands over and over again!"</span>

![](../images/docker3.png){width="3600px" style="margin-bottom: 0px;"}

<p style="position: fixed; bottom: 0px; left: 0px; font-size: 18px; color: gray; z-index: 1000;">Image generated by OpenAI GPT-5 and Canva</p> 

## <span style="font-size: 0.7em;">"I want others to easily use my docker container!"</span>

![](../images/docker4.png){width="3600px" style="margin-bottom: 0px;"}

<p style="position: fixed; bottom: 0px; left: 0px; font-size: 18px; color: gray; z-index: 1000;">Image generated by OpenAI GPT-5 and Canva</p> 

## Docker image, data, code: all in one place? 

* üê≥ Docker image ‚û°Ô∏è [Docker Hub](https://hub.docker.com/)
* üìú Code ‚û°Ô∏è GitHub repository
* üìä Data (small) ‚û°Ô∏è GitHub repository
* üìä Data (large) ‚û°Ô∏è Cloud storage (e.g., [AWS S3](https://aws.amazon.com/s3/)); [Zenodo](https://zenodo.org/); [Borealis Dataverse](https://borealisdata.ca/dataverse/ubc)


## Real-world example: Nature

::: {.smaller style="font-size: 0.8em;"}

* If you ever submit a paper to *Nature* journals, you will be asked to upload your code & data to [Code Ocean](https://codeocean.com/resources/nature-partnership)

:::

![](../images/nature.png){width="4500px" style="margin-bottom: 0px; display: block; margin-left: auto; margin-right: auto;"}

## <span style="font-size: 0.7em;">Something to look forward to at the end of DSCI 522... </span>

::: {.smaller style="font-size: 0.8em;"}

* ü§ñ AI agents and fully automated data science workflows using Model Context Protocols (MCPs)
* üê≥ Most MCP servers are built using Docker containers

:::
![](../images/docker_mcp.png){width="5000px" style="margin-bottom: 0px; display: block; margin-left: auto; margin-right: auto;"}

# üéä That's all for Docker for now 

* Docker Cheatsheet is available [here](../cheatsheets/cheatsheet_docker.html)

# Today's topic: Non-interactive scripts üìú

## You have already been using scripts!

::: {.smaller style="font-size: 0.8em;"}
* [GitHub repo: append_version_to_environment_yml](https://github.com/skysheng7/append_version_to_environment_yml.git)
* `python update_enviroment_yml.py --root_dir="." --env_name="ai_env" --yml_name="environment.yml"`
:::

![](../images/conda3.png){width="5600px" style="margin-bottom: 0px;"}

# What is a script? 

::: {.incremental}
* A script is a plain text file that contains sequence of commands (e.g., written in R or Python). It is usually executed from top to bottom from the command line. 
* Example: [update_environment_yml.py](https://github.com/skysheng7/append_version_to_environment_yml/blob/main/update_enviroment_yml.py)
:::

<p style="position: fixed; bottom: 0px; left: 0px; font-size: 18px; color: gray; z-index: 1000;">Source: [Timbers, T. A., Ostblom, J., D'Andrea, F., Lourenzutti, R., & Chen, D. Reproducible and Trustworthy Workflows for Data Science
](https://ubc-dsci.github.io/reproducible-and-trustworthy-workflows-for-data-science/lectures/150-scripts.html)</p> 


## Read-eval-print-loop (REPL) framework (i.e., interactive mode)

::: {.incremental}
* Read-eval-print-loop (REPL) framework is when the machine reads the input, evalutes/executes them through functions, print out the result to the user. üëÄ --> ‚úÖ --> üñ®Ô∏è
* REPL example: 
    * Run code in console for R & Python
    * Run code in cells of Jupyter Notebook

:::

## What are the problems with Jupyter Notebook? 

::: {.incremental}
* ü§î Example 1: What if we turn [update_environment_yml.py](https://github.com/skysheng7/DSCI522_data_validation_demo/blob/main/problematic_notebooks/update_enviroment_yml.ipynb) into a Jupyter Notebook and always run cell by cell?
* üòµ‚Äçüí´ Example 2: [A jupyter notebook](https://github.com/skysheng7/DSCI522_data_validation_demo/blob/main/problematic_notebooks/Megadata%20Plot%20Generation.ipynb) to analyze images output by text-to-image generative models. [Old commit history in November 2024 for this repository](https://github.com/skysheng7/AI_bias_in_farming/tree/639fd7b8515a411995793d761adb1f1e9661775b). My Problems are:
    * 4800 images generated
    * 25 visualization plots generated
:::

## What are the problems with Jupyter Notebook? 

::: {.incremental}
* üòµ Do you want to show every single step of your analysis in one single file to your reader? 
    * Remember my [5000-line R code](https://github.com/skysheng7/moo4feed/blob/main/data-raw/old_scripts/master_script_HOBO_Insentec_combined_Sockeye_v12.R) that you roasted? üî•
:::

## üí° What are the benefits of using scripts?

::: {.incremental}
* Abstraction: Hide the complexity of the code from the user
* Reusability: The script can be reused by others
    * e.g., I moved the [update_environment_yml.py](https://github.com/skysheng7/append_version_to_environment_yml/blob/main/update_enviroment_yml.py) script out from my original repository and shared it with you
* Efficiency: The script can be run in parallel
* Automation: Scripts can be used with other tools (e.g., GNU Make) to automate the entire workflow
* Ease of use: The script can be run with a single command
* Ease of debugging: Modular code is easier to debug
:::

## üåü Read-eval-print-loop (REPL) framework VS Scripts

::: {.smaller style="font-size: 0.7em;"}
| Aspect | REPL (e.g., Jupyter Notebook) | Scripts |
|----|-------------|---------|
| **Execution** | Interactive, line-by-line or cell-by-cell | Batch mode, top to bottom |
| **Best for** | Solving small problems, developing code, exploratory analysis | Automation, production workflows, reproducible pipelines |
| **Advantages** | Immediate feedback, easy for small problems and experiments | Efficiency, automation, reusability, reproducibility |
| **Examples** | R/Python console, Jupyter Notebook cells | `.py`, `.R` files run from command line |
| **Complexity** | Can become messy with large analyses | Better for complex, modular workflows |
| **Debugging** | Harder with non-linear execution | Easier with linear, modular code |
:::

## üèÑüèª‚Äç‚ôÄÔ∏è Let's dive into python scripts!

* Scan through the [update_environment_yml.py](https://github.com/skysheng7/append_version_to_environment_yml/blob/main/update_enviroment_yml.py) script and discuss the following questions with your neighbor:
  * What is the structure of this script? 
  * Where are the documentation comments? 
  * What is the structure and style of the documentation? 
  * Where is the packages get imported? 
  * What is the purpose of `@click.option()`?
  * Why do we need `if __name__ == "__main__":` at the end?

## Example python script organization

::: {.smaller style="font-size: 0.9em;"}
```python
# documentation comments

# import libraries/packages

# parse/define command line arguments here

# code for other functions

# define main function
def main():
    # code for "guts" of script goes here

# call main function
if __name__ == "__main__":
    main() # pass any command line args to main here
```
:::

## Docstring: Google Style

::: {.smaller style="font-size: 0.9em;"}
```python
def func(arg1, arg2):
    """Summary line.

    Extended description of function.

    Args:
        arg1 (int): Description of arg1
        arg2 (str): Description of arg2

    Returns:
        bool: Description of return value

    Raises:
        IOError: An error occurred accessing the file.
    """
    return True
```
:::

<p style="position: fixed; bottom: 0px; left: 0px; font-size: 18px; color: gray; z-index: 1000;">[Source](https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html)</p> 



## Docstring: Numpy Style

::: {.smaller style="font-size: 0.9em;"}
```python
def func(arg1, arg2):
    """Summary line.

    Extended description of function.

    Parameters
    ----------
    arg1 : int
        Description of arg1
    arg2 : str
        Description of arg2

    Returns
    -------
    bool
        Description of return value

    Raises
    ------
    KeyError
        when a key error
    """
    return True
```
:::

<p style="position: fixed; bottom: 0px; left: 0px; font-size: 18px; color: gray; z-index: 1000;">[Source](https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html)</p> 

## Why does docstring style matter?

::: {.incremental}
::: {.smaller style="font-size: 0.9em;"}
* Readability: Your collaborators, future users, and future you will thank you for writing clear and concise docstrings.
* Good docstring should be both human-readable and machine-readable.

* Python Example:
  * [Source code for `pandas.DataFrame.head`](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.head.html)
  * [API for `pandas.DataFrame.head`](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.head.html)

* R Example:
  * [Source code for `moo4feed` package `cluster_meals`](https://github.com/skysheng7/moo4feed/blob/main/R/cluster_meals.R)
  * [API for `moo4feed` package `cluster_meals`](https://www.skysheng.io/moo4feed/reference/cluster_meals.html)
:::
:::

## Tips for python scripts

:::{.callout-note}
* `if __name__ == "__main__":` lets you source the other functions in the script without running the main function.
* `click` commands need to be placed right above the main function. 
:::

::: {.smaller style="font-size: 0.9em;"}
Example:

```python
# import libraries/packages
import click

# parse/define command line arguments below
# define main function
@click.command()
@click.argument('num1', type=int)
@click.argument('num2', type=int)
def main(num1, num2):
    """Simple program that adds two numbers."""
    result = num1 + num2
    click.echo(f"The sum of {num1} and {num2} is {result}")

# call main function
if __name__ == '__main__':
    main()
```
:::
